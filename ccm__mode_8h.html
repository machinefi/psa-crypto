<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PSA Crypto: src/include/tinycrypt/ccm_mode.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PSA Crypto
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_b0856f6b0d80ccb263b2f415c91f9e17.html">include</a></li><li class="navelem"><a class="el" href="dir_cb82b0834b2d4ad8b46d6782ee28b60e.html">tinycrypt</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">ccm_mode.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Interface to a CCM mode implementation.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="tinycrypt_2aes_8h_source.html">aes.h</a>&quot;</code><br />
<code>#include &lt;stddef.h&gt;</code><br />
</div>
<p><a href="ccm__mode_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtc__ccm__mode__struct.html">tc_ccm_mode_struct</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:acfa60ccbf5cc598f2bf6dc1b462cd2fe"><td class="memItemLeft" align="right" valign="top"><a id="acfa60ccbf5cc598f2bf6dc1b462cd2fe"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>TC_CCM_AAD_MAX_BYTES</b>&#160;&#160;&#160;0xff00</td></tr>
<tr class="separator:acfa60ccbf5cc598f2bf6dc1b462cd2fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cc6cffd6da6c7517816fb4990e46584"><td class="memItemLeft" align="right" valign="top"><a id="a6cc6cffd6da6c7517816fb4990e46584"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>TC_CCM_PAYLOAD_MAX_BYTES</b>&#160;&#160;&#160;0x10000</td></tr>
<tr class="separator:a6cc6cffd6da6c7517816fb4990e46584"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a91adef5996b1bf862d6058e2bffc48e7"><td class="memItemLeft" align="right" valign="top"><a id="a91adef5996b1bf862d6058e2bffc48e7"></a>
typedef struct <a class="el" href="structtc__ccm__mode__struct.html">tc_ccm_mode_struct</a> *&#160;</td><td class="memItemRight" valign="bottom"><b>TCCcmMode_t</b></td></tr>
<tr class="separator:a91adef5996b1bf862d6058e2bffc48e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1803e34ba4fe828f46122fc506b5931a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccm__mode_8h.html#a1803e34ba4fe828f46122fc506b5931a">tc_ccm_config</a> (<a class="el" href="structtc__ccm__mode__struct.html">TCCcmMode_t</a> c, <a class="el" href="structtc__aes__key__sched__struct.html">TCAesKeySched_t</a> sched, uint8_t *nonce, unsigned int nlen, unsigned int mlen)</td></tr>
<tr class="memdesc:a1803e34ba4fe828f46122fc506b5931a"><td class="mdescLeft">&#160;</td><td class="mdescRight">CCM configuration procedure.  <a href="ccm__mode_8h.html#a1803e34ba4fe828f46122fc506b5931a">More...</a><br /></td></tr>
<tr class="separator:a1803e34ba4fe828f46122fc506b5931a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9829904cae05c9bd13e7acde0025101e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccm__mode_8h.html#a9829904cae05c9bd13e7acde0025101e">tc_ccm_generation_encryption</a> (uint8_t *out, unsigned int olen, const uint8_t *associated_data, unsigned int alen, const uint8_t *payload, unsigned int plen, <a class="el" href="structtc__ccm__mode__struct.html">TCCcmMode_t</a> c)</td></tr>
<tr class="memdesc:a9829904cae05c9bd13e7acde0025101e"><td class="mdescLeft">&#160;</td><td class="mdescRight">CCM tag generation and encryption procedure.  <a href="ccm__mode_8h.html#a9829904cae05c9bd13e7acde0025101e">More...</a><br /></td></tr>
<tr class="separator:a9829904cae05c9bd13e7acde0025101e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a602d1711fa8ff5eb236e1cb1947f3f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ccm__mode_8h.html#a0a602d1711fa8ff5eb236e1cb1947f3f">tc_ccm_decryption_verification</a> (uint8_t *out, unsigned int olen, const uint8_t *associated_data, unsigned int alen, const uint8_t *payload, unsigned int plen, <a class="el" href="structtc__ccm__mode__struct.html">TCCcmMode_t</a> c)</td></tr>
<tr class="memdesc:a0a602d1711fa8ff5eb236e1cb1947f3f"><td class="mdescLeft">&#160;</td><td class="mdescRight">CCM decryption and tag verification procedure.  <a href="ccm__mode_8h.html#a0a602d1711fa8ff5eb236e1cb1947f3f">More...</a><br /></td></tr>
<tr class="separator:a0a602d1711fa8ff5eb236e1cb1947f3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Interface to a CCM mode implementation. </p>
<p>Overview: CCM (for "Counter with CBC-MAC") mode is a NIST approved mode of operation defined in SP 800-38C.</p>
<p>TinyCrypt CCM implementation accepts:</p>
<p>1) Both non-empty payload and associated data (it encrypts and authenticates the payload and also authenticates the associated data); 2) Non-empty payload and empty associated data (it encrypts and authenticates the payload); 3) Non-empty associated data and empty payload (it degenerates to an authentication mode on the associated data).</p>
<p>TinyCrypt CCM implementation accepts associated data of any length between 0 and (2^16 - 2^8) bytes.</p>
<p>Security: The mac length parameter is an important parameter to estimate the security against collision attacks (that aim at finding different messages that produce the same authentication tag). TinyCrypt CCM implementation accepts any even integer between 4 and 16, as suggested in SP 800-38C.</p>
<p>RFC-3610, which also specifies CCM, presents a few relevant security suggestions, such as: it is recommended for most applications to use a mac length greater than 8. Besides, the usage of the same nonce for two different messages which are encrypted with the same key destroys the security of CCM mode.</p>
<p>Requires: AES-128</p>
<p>Usage: 1) call tc_ccm_config to configure. </p><pre class="fragment">      2) call tc_ccm_mode_encrypt to encrypt data and generate tag.

      3) call tc_ccm_mode_decrypt to decrypt data and verify tag.
</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="a1803e34ba4fe828f46122fc506b5931a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1803e34ba4fe828f46122fc506b5931a">&#9670;&nbsp;</a></span>tc_ccm_config()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tc_ccm_config </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structtc__ccm__mode__struct.html">TCCcmMode_t</a>&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structtc__aes__key__sched__struct.html">TCAesKeySched_t</a>&#160;</td>
          <td class="paramname"><em>sched</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>nonce</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>nlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>mlen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>CCM configuration procedure. </p>
<dl class="section return"><dt>Returns</dt><dd>returns TC_CRYPTO_SUCCESS (1) returns TC_CRYPTO_FAIL (0) if: c == NULL or sched == NULL or nonce == NULL or mlen != {4, 6, 8, 10, 12, 16} </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">c</td><td>&ndash; CCM state </td></tr>
    <tr><td class="paramname">sched</td><td>IN &ndash; AES key schedule </td></tr>
    <tr><td class="paramname">nonce</td><td>IN - nonce </td></tr>
    <tr><td class="paramname">nlen</td><td>&ndash; nonce length in bytes </td></tr>
    <tr><td class="paramname">mlen</td><td>&ndash; mac length in bytes (parameter t in SP-800 38C) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a0a602d1711fa8ff5eb236e1cb1947f3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a602d1711fa8ff5eb236e1cb1947f3f">&#9670;&nbsp;</a></span>tc_ccm_decryption_verification()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tc_ccm_decryption_verification </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>olen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>associated_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>alen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>plen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structtc__ccm__mode__struct.html">TCCcmMode_t</a>&#160;</td>
          <td class="paramname"><em>c</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>CCM decryption and tag verification procedure. </p>
<dl class="section return"><dt>Returns</dt><dd>returns TC_CRYPTO_SUCCESS (1) returns TC_CRYPTO_FAIL (0) if: out == NULL or c == NULL or ((plen &gt; 0) and (payload == NULL)) or ((alen &gt; 0) and (associated_data == NULL)) or (alen &gt;= TC_CCM_AAD_MAX_BYTES) or (plen &gt;= TC_CCM_PAYLOAD_MAX_BYTES) or (olen &lt; plen - c-&gt;mlen)</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">out</td><td>OUT &ndash; decrypted data </td></tr>
    <tr><td class="paramname">associated_data</td><td>IN &ndash; associated data </td></tr>
    <tr><td class="paramname">alen</td><td>IN &ndash; associated data length in bytes </td></tr>
    <tr><td class="paramname">payload</td><td>IN &ndash; payload </td></tr>
    <tr><td class="paramname">plen</td><td>IN &ndash; payload length in bytes </td></tr>
    <tr><td class="paramname">c</td><td>IN &ndash; CCM state</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>: out buffer should be at least (plen - c-&gt;mlen) bytes long.</dd>
<dd>
: The sequence b for encryption is formatted as follows: b = [FLAGS | nonce | counter ], where: FLAGS is 1 byte long nonce is 13 bytes long counter is 2 bytes long The byte FLAGS is composed by the following 8 bits: 0-2 bits: used to represent the value of q-1 3-7 btis: always 0's</dd>
<dd>
: The sequence b for authentication is formatted as follows: b = [FLAGS | nonce | length(mac length)], where: FLAGS is 1 byte long nonce is 13 bytes long length(mac length) is 2 bytes long The byte FLAGS is composed by the following 8 bits: 0-2 bits: used to represent the value of q-1 3-5 bits: mac length (encoded as: (mlen-2)/2) 6: Adata (0 if alen == 0, and 1 otherwise) 7: always 0 </dd></dl>

</div>
</div>
<a id="a9829904cae05c9bd13e7acde0025101e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9829904cae05c9bd13e7acde0025101e">&#9670;&nbsp;</a></span>tc_ccm_generation_encryption()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tc_ccm_generation_encryption </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>olen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>associated_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>alen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>plen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structtc__ccm__mode__struct.html">TCCcmMode_t</a>&#160;</td>
          <td class="paramname"><em>c</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>CCM tag generation and encryption procedure. </p>
<dl class="section return"><dt>Returns</dt><dd>returns TC_CRYPTO_SUCCESS (1) returns TC_CRYPTO_FAIL (0) if: out == NULL or c == NULL or ((plen &gt; 0) and (payload == NULL)) or ((alen &gt; 0) and (associated_data == NULL)) or (alen &gt;= TC_CCM_AAD_MAX_BYTES) or (plen &gt;= TC_CCM_PAYLOAD_MAX_BYTES) or (olen &lt; plen + maclength)</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">out</td><td>OUT &ndash; encrypted data </td></tr>
    <tr><td class="paramname">olen</td><td>IN &ndash; output length in bytes </td></tr>
    <tr><td class="paramname">associated_data</td><td>IN &ndash; associated data </td></tr>
    <tr><td class="paramname">alen</td><td>IN &ndash; associated data length in bytes </td></tr>
    <tr><td class="paramname">payload</td><td>IN &ndash; payload </td></tr>
    <tr><td class="paramname">plen</td><td>IN &ndash; payload length in bytes </td></tr>
    <tr><td class="paramname">c</td><td>IN &ndash; CCM state</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>: out buffer should be at least (plen + c-&gt;mlen) bytes long.</dd>
<dd>
: The sequence b for encryption is formatted as follows: b = [FLAGS | nonce | counter ], where: FLAGS is 1 byte long nonce is 13 bytes long counter is 2 bytes long The byte FLAGS is composed by the following 8 bits: 0-2 bits: used to represent the value of q-1 3-7 btis: always 0's</dd>
<dd>
: The sequence b for authentication is formatted as follows: b = [FLAGS | nonce | length(mac length)], where: FLAGS is 1 byte long nonce is 13 bytes long length(mac length) is 2 bytes long The byte FLAGS is composed by the following 8 bits: 0-2 bits: used to represent the value of q-1 3-5 bits: mac length (encoded as: (mlen-2)/2) 6: Adata (0 if alen == 0, and 1 otherwise) 7: always 0 </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
